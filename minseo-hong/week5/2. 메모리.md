메모리
=============

# 1. 메모리 할당

## 1.1. stdlib.h

메모리 할당을 위해서는 stdlib.h 헤더 파일을 포함해야 한다.

```c
#include <stdlib.h>
```

이 헤더 파일에서 메모리 할당과 해제를 위한 malloc 함수와 free 함수를 사용한다.

## 1.2. 포인터

먼저 포인터를 선언해야 한다.

```c
int *numPtr;
```

이 포인터를 통해 일정 크기의 메모리를 할당할 것이다. 메모리가 할당된 후에는 포인터에 그 메모리를 가리키는 주소가 자동으로 대입된다.

## 1.3. malloc 함수

메모리 할당은 malloc 함수를 이용한다.

```c
numPtr = malloc(sizeof(int));
```

malloc 함수에 들어가는 인수는 할당할 크기이며 바이트 단위로 나타낸다.

sizeof 함수를 이용해 int 자료형의 바이트 크기를 구한 후 이를 malloc에 인수로 넣어 int 자료형 크기만큼의 메모리를 numPtr 포인터에 저장된 메모리 주소에 할당한다.

### 1.3.1. 동적 메모리 할당

### 1.3.2. 포인터 선언과 동시에 메모리 할당

포인터 선언과 메모리 할당을 아래처럼 동시에 할 수도 있다.

```c
int *numPtr = malloc(sizeof(int));
```

이렇듯 원하는 시점에 원하는 크기의 메모리를 할당하는 것을 동적 메모리 할당이라고 한다.

## 1.4. free 함수

메모리를 할당하여 사용한 후에는 반드시 할당한 메모리를 해제해주어야 한다. 메모리 해제는 free 함수를 사용한다.

```c
free(numPtr)
```

free 함수에 포인터를 인수로 넣어 할당된 메모리를 해제할 수 있다.

### 1.4.1. 메모리 누수

메모리 할당한 후 해제해주지 않으면 메모리에서 일정 크기를 계속 차지하게 되어 메모리 할당을 많이 할수록 점점 메모리에 쌓이게 된다. 그리고 메모리에 너무 많이 쌓이게 되면 운영체제의 작동이 느려지므로 운영체제는 메모리에 많은 공간을 차지하는 프로그램을 자동으로 종료하게 된다. 이렇게 되면 우리가 만든 프로그램이 의도치 않게 비정상적으로 종료될 수 있다. 이를 '메모리 누수(memory leak)'라고 한다.

# 2. 메모리에 값 저장

메모리를 할당했으면 이 메모리를 사용해야 한다. 포인터 변수를 이용해 메모리를 할당했으므로 이 메모리를 사용하기 위해서는 포인터를 사용해야 하며, 이때 포인터의 역참조를 사용한다.

## 2.1. 역참조

포인터의 역참조를 이용해 할당한 메모리에 값을 저장할 수 있다.

```c
int *numPtr = malloc(sizeof(int));

*numPtr = 10; // 역참조 이용

printf("%d\n", *numPtr);

free(numPtr);
```

## 2.2. 한꺼번에 값 변경

할당한 메모리 안에 있는 내용을 memset 함수를 이용해 특정 값으로 한꺼번에 지정할 수 있다.

### 2.2.1. string.h 또는 memory.h

memset 함수를 이용하기 위해서는 string.h 또는 memory.h 헤더 파일을 포함해야 한다.

```c
#include <string.h> // #include <memory.h>
```

### 2.2.2. memset 함수

memset 함수를 이용하여 특정 값으로 메모리 안에 있는 내용을 한꺼번에 지정할 수 있다.

```c
long long *numPtr = malloc(sizeof(long long));

memset(numPtr, 0x18, 8);
```

memset에 들어가는 인수는 총 3개로 차례대로 값을 지정할 포인터, 지정할 값, 바이트 크기이다. 이때 메모리 1바이트당 0x18이라는 값이 들어가고, 총 8바이트이므로 최종적인 값은 아래와 같다.

```c
printf("%x\n", %numPtr); // 0x1818181818181818
```

### 2.2.3. 메모리를 0으로 초기화

memset 함수는 주로 할당된 메모리의 값을 0으로 초기화할 때 사용된다.

```c
memset(numPtr, 0, 8);
```

# 3. 널 포인터

## 3.1. 의미

가리키고 있는 메모리 주소가 없는 포인터를 의미한다. 가리키는 곳이 없으므로 역참조 또한 불가능하다.

```c
int *numPtr = NULL;

printf("%p\n", numPtr); // 00000000
```

## 3.2. 이용

널 포인터는 동적 메모리 할당을 하기 전 포인터가 NULL인지, 즉 메모리가 할당되지 않았는지를 확인할 때 쓰인다.

```c
if (numPtr == NULL) {
	numPtr = malloc(sizeof(int))
}
```

위 코드의 경우 numPtr이 가리키고 있는 메모리가 없는지 확인한 후, 없으면 메모리를 할당하는 코드이다. 위의 패턴으로 널 포인터가 실무에서 자주 쓰인다.
